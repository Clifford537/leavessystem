<app-header/>
<div class="set-password-container">
  <mat-card class="set-password-card mat-elevation-z8">
    <h2 class="title">Set Your Password</h2>

    <!-- Step 1: Verify User -->
    <form *ngIf="step === 1" [formGroup]="verifyForm" (ngSubmit)="verifyUser()">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>ID Number</mat-label>
        <input matInput formControlName="idno" placeholder="Enter your ID number" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Staff Number</mat-label>
        <input matInput formControlName="staffno" placeholder="Enter your Staff number" />
      </mat-form-field>

      <div *ngIf="errorMessage" class="error-message">
        <mat-icon>error</mat-icon>
        {{ errorMessage }}
      </div>

      <button mat-raised-button color="primary" class="full-width" type="submit" [disabled]="verifyForm.invalid || loading">
        <mat-icon class="icon-left">search</mat-icon>
        {{ loading ? 'Verifying...' : 'Verify Identity' }}
      </button>
    </form>

    <!-- Step 2: Set Password -->
    <form *ngIf="step === 2" [formGroup]="passwordForm" (ngSubmit)="setPassword()">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>New Password</mat-label>
        <input matInput type="password" formControlName="password" placeholder="Create a strong password" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirm Password</mat-label>
        <input matInput type="password" formControlName="confirmPassword" placeholder="Re-enter your password" />
      </mat-form-field>

      <div *ngIf="errorMessage" class="error-message">
        <mat-icon>error</mat-icon>
        {{ errorMessage }}
      </div>

      <div *ngIf="successMessage" class="success-message">
        <mat-icon color="primary">check_circle</mat-icon>
        {{ successMessage }}
      </div>

      <button mat-raised-button color="primary" class="full-width" type="submit" [disabled]="passwordForm.invalid || loading">
        <mat-icon class="icon-left">lock</mat-icon>
        {{ loading ? 'Saving...' : 'Set Password' }}
      </button>
    </form>
  </mat-card>
</div>
